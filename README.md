
[![pub package](https://img.shields.io/pub/v/screenshots.svg)](https://pub.dartlang.org/packages/screenshots) 
[![Build Status](https://travis-ci.com/mmcc007/screenshots.svg?branch=master)](https://travis-ci.com/mmcc007/screenshots)

![alt text][demo]

[demo]: https://i.imgur.com/gkIEQ5y.gif "Screenshot with overlayed 
status bar and appended navigation bar placed in frame"  
A screenshot image with overlaid status bar and appended navigation bar placed in a device frame.  

For an example of images generated with Screenshots on a live app in both stores see:  
[![GitErDone](https://play.google.com/intl/en_us/badges/images/badge_new.png)](https://play.google.com/store/apps/details?id=com.orbsoft.todo)
[![GitErDone](https://linkmaker.itunes.apple.com/en-us/badge-lrg.svg?releaseDate=2019-02-15&kind=iossoftware)](https://itunes.apple.com/us/app/giterdone/id1450240301)


See a demo of Screenshots in action:
[![Screenshots demo](https://i.imgur.com/V9VFSYb.png)](https://vimeo.com/317112577 "Screenshots demo - Click to Watch!")

For introduction to Screenshots see https://medium.com/@nocnoc/automated-screenshots-for-flutter-f78be70cd5fd.

For demo of uploading screenshot images generated by Screenshots to both Apple and Google consoles see 
https://github.com/mmcc007/fledge.

# Screenshots

`Screenshots` is a standalone command line utility and package for capturing screenshots for Flutter.   

Screenshots will start the required android emulators and iOS simulators, run your screen 
capture tests on each emulator/simulator, process the images, and drop them off to Fastlane 
for delivery to both stores.

It is inspired by three tools from Fastlane:  
1. [Snapshots](https://docs.fastlane.tools/getting-started/ios/screenshots/)  
This is used to capture screenshots on iOS using iOS UI Tests.
1. [Screengrab](https://docs.fastlane.tools/actions/screengrab/)  
This captures screenshots on android using android espresso tests.
1. [FrameIt](https://docs.fastlane.tools/actions/frameit/)  
This is used to place captured iOS screenshots in a device frame.

Since all three of these Fastlane tools do not work with Flutter, Screenshots combines key features of all three Fastlane tools into one tool. Plus, it is much easier to use! 

# Features
Screenshots features:  
1. One test for both platforms  
Write one test for both iOS and Android.  
(No need to write separate iOS UI Tests or Espresso tests.)
1. One run for both platforms  
Screenshots runs your tests on both iOS and Android in one run.  
(as opposed to making separate Snapshots and Screengrab runs)
1. One run for multiple tests  
Screenshots will run all the tests listed in config file.
1. One run for multiple locales  
If your app supports multiple locales, Screenshots will optionally set the locales listed in the config file before running each test.
1. One run for frames  
Optionally places images in device frames in same run.  
(as opposed to making separate FrameIt runs... which supports iOS only)
1. Works with Fastlane  
Screenshots drops-off images where Fastlane expects to find them. Fastlane's [deliver](https://docs.fastlane.tools/actions/deliver/) and [supply](https://docs.fastlane.tools/actions/supply/) can then be used to upload to respective stores.

# Installation
````bash
$ pub global activate screenshots
````

# Usage

````
$ screenshots
````
Or, if using a config file other than the default 'screenshots.yaml':
````
$ screenshots -c <path to config file>
````

# Modifying your tests for Screenshots
A special function is provided in the Screenshots package that is called by the test each time you want to capture a screenshot. 
Screenshots will
then process the images appropriately during a Screenshots run.

To capture screenshots in your tests:
1. Include the Screenshots package in your pubspec.yaml's dev_dependencies section  
   ````yaml
     screenshots: ^<current version>
   ````
2. In your tests
    1. Import the dependencies  
       ````dart
       import 'package:screenshots/config.dart';
       import 'package:screenshots/capture_screen.dart';
       ````
    2. Create the config map at start of test  
       ````dart
            final Map config = Config().config;
       ````  
    3. Throughout the test make calls to capture screenshots  
       ````dart
           await screenshot(driver, config, 'myscreenshot1');
       ````
       
Note: make sure your screenshot names are unique across all your tests.

Note: to turn off the debug banner on your screens, in your integration test's main(), call:
````dart
  WidgetsApp.debugAllowBannerOverride = false; // remove debug banner for screenshots
````

# Configuration
Screenshots uses a configuration file to configure a run.  
 The default config filename is `screenshots.yaml`:
````yaml
# A list of screen capture tests
tests:
  - test_driver/main1.dart
  - test_driver/main2.dart

# Note: flutter driver expects a pair of files for testing
# For example:
#   main1.dart is the test app (that calls your app)
#   main1_test.dart is the test that flutter driver expects to find

# Interim location of screenshots from tests
staging: /tmp/screenshots

# A list of locales supported by the app
locales:
  - de-DE
  - en-US

# A list of devices to emulate
devices:
  ios:
    - iPhone X
    - iPad Pro (12.9-inch) (2nd generation)
  android:
    - Nexus 6P

# Frame screenshots
frame: true
````
Note: emulators and simulators corresponding to the devices in your config file must be installed
on your test machine.

## Dependencies
Screenshots depends on ImageMagick.  

Since screenshots are required by both Apple and Google stores, testing should be done on a Mac
(unless you are only testing for android).

````bash
brew update && brew install imagemagick
````

# Integration with Fastlane
Since Screenshots is intended to be used with Fastlane, after Screenshots completes, 
the images can be found in:
````
android/fastlane/metadata/android
ios/fastlane/screenshots
````
Images are in a format suitable for upload via [deliver](https://docs.fastlane.tools/actions/deliver/) 
and [supply](https://docs.fastlane.tools/actions/supply/).

Tip: Because Fastlane scripts are generally written for either iOS or Android (and not both), the easiest way to use Screenshots with Fastlane is to call Screenshots before making the two calls to Fastlane. Each call to Fastlane (for either iOS or Android) will then find the images in the appropriate place and can then upload the images to either the Apple or Google store consoles.  
(For a live example of calling Fastlane for iOS and Android to upload screenshot images see Travis demo at https://github.com/mmcc007/fledge)

## Changing devices

If you want to know what your screens look like on different devices just change the list of devices in screenshots.yaml.

Make sure the devices
you select have supported screens and corresponding emulators/simulators.

_Within each class of ios and android device, multiple devices share the same screen size.
Devices are therefore organized by supported screens in a file called `screens.yaml`._

For each selected device:
1. Confirm device in present in 
[screens.yaml](https://github.com/mmcc007/screenshots/blob/master/lib/resources/screens.yaml).  
2. Add device to the list of devices in `screenshots.yaml`.  
3. Install an emulator or simulator for device.   
 
If changing devices seems tricky at first. Don't worry. Screenshots will validate the config file before running.

If you want to use a device that is not included in screens.yaml
, please create an [issue](https://github.com/mmcc007/screenshots/issues). Include
the name of the device and preferably the size of the screen in pixels 
(for example, Nexus 5X:1080x1920).

# Upgrading
To upgrade, simply re-issue the install command
````bash
$ pub global activate screenshots
````
Note: the Screenshots version should be the same for both the command line and package:
1. If upgrading the command line version of Screenshots, it is helpful to also upgrade
 the version of Screenshots in your pubspec.yaml.    
2. If upgrading Screenshots in your pubspec.yaml, you should also upgrade the command line version.    

# Sample run on Travis
To view Screenshots running with the [example](example) app on travis see:  
https://travis-ci.com/mmcc007/screenshots

To view the images generated by Screenshots during run on travis see:  
https://github.com/mmcc007/screenshots/releases/

# Issues and Pull Requests
[Issues](https://github.com/mmcc007/screenshots/issues) and 
[pull requests](https://github.com/mmcc007/screenshots/pulls) are welcome.

Your feedback is welcome and is used to guide where development effort is focused. So feel free to create as many issues and pull requests as you see fit. You should expect a timely and considered response.